helper-create-vm-array-cmd() { CMD=""; for type in net pci usb serial parallel scsi sata ide nvme rng audio; do index=0; eval "for item in \"\${VM_${type^^}[@]}\"; do [[ -n \"\$item\" ]] || break; case \"$type\" in net) item=\$( [[ \"\$item\" == \"-\" ]] && echo \"model=\${VM_NETHW:-e1000}\" || echo \"\$item\" ); item=\$( [[ \"\$item\" != *\"model=\"* ]] && echo \"model=\${VM_NETHW:-e1000},\" || echo \"\" )\$item\$( [[ \"\$item\" != *\"bridge=\"* && -n \"\$VM_NETWORK_BRIDGE\" ]] && echo \",bridge=\$VM_NETWORK_BRIDGE\" )\$( [[ \"\$item\" != *\"firewall=\"* ]] && echo \",firewall=0\" )\$( [[ \"\$item\" != *\"macaddr=\"* ]] && echo \",macaddr=DE:AD:BE:EF:\$(hexdump -n2 -e '/1 \"\:%02X\"' /dev/urandom):\$(hexdump -n1 -e '/1 \"\:%02X\"' /dev/urandom)\" )\$( [[ \"\$item\" != *\"tag=\"* && -n \"\$VM_NET_TAG\" ]] && echo \",tag=\$VM_NET_TAG\" )\$( [[ \"\$item\" != *\"link_down=\"* && -n \"\$VM_NET_STATUS\" ]] && echo \",link_down=\$VM_NET_STATUS\" );; scsi|sata|ide|nvme) [[ \"\$index\" -lt \$( [[ \"\$type\" == \"sata\" ]] && echo 6 || [[ \"\$type\" == \"ide\" ]] && echo 3 || echo 31 ) ]] || break; item=\$( [[ \"\$item\" =~ ^[0-9]+$ ]] && echo \"\$VM_STORAGE_DISK:\$item\" || [[ \"\$item\" == \"-\" ]] && echo \"\$VM_STORAGE_DISK:32\" || [[ \"\$item\" != *\":\"* ]] && echo \"\$VM_STORAGE_DISK:\$item\" || echo \"\$item\" ); for attr in backup=0 cache=writeback discard=on; do [[ \"\$item\" != *\"\${attr%=*}=\"* ]] && item+=\",\$attr\"; done; [[ \"\$item\" != *\"media=cdrom\"* && \"\$item\" != *\"iothread=\"* ]] && item+=\",iothread=1\";; rng) [[ \"\$index\" -lt 1 ]] || break; [[ \"\$item\" == \"-\" || \"\$item\" != *\"source=\"* ]] && item=\"source=/dev/urandom\$item\"; for attr in \"max_bytes=\$VM_RNG_MAX\" \"period=\$VM_RNG_PERIOD\"; do [[ \"\$item\" != *\"\${attr%=*}=\"* && -n \"\${attr#*=}\" ]] && item+=\",\$attr\"; done;; audio) [[ \"\$index\" -lt 1 ]] || break; [[ \"\$item\" == \"-\" || \"\$item\" == \"ich9-intel-hda\" || \"\$item\" == \"ich9\" || \"\$item\" != *\"device=\"* ]] && item=\"device=ich9-intel-hda\$item\"; [[ \"\$item\" == \"intel-hda\" || \"\$item\" == \"hda\" ]] && item=\"device=intel-hda\$item\"; [[ \"\$item\" == \"AC97\" || \"\$item\" == \"ac97\" ]] && item=\"device=AC97\$item\"; [[ \"\$item\" != *\"driver=\"* ]] && item+=\$( [[ \"\$VM_SPICE\" == \"1\" ]] && echo \",driver=spice\" || echo \",driver=none\" );; esac; CMD+=\" --\$type\${index} \$item\"; ((index++)); done"; done; }