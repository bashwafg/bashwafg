helper-repack-iso-inject-files-into-wim() { local arr_name="$1" wim_file="$2"; eval "local arr=(\"\${${arr_name}[@]}\")"; local image_count; image_count=$(wimlib-imagex info "$wim_file" | grep -i 'Image Count' | awk '{print $NF}'); for i in $(seq 1 "$image_count"); do for entry in "${arr[@]}"; do local src="${entry%%,*}" rest="${entry#*,}" dest=""; if [[ "$src" == //* ]]; then src=$(helper-repack-iso-mount-smb "$entry") || continue; if [[ "$rest" == *"username="* ]]; then IFS=',' read -r _ _ dest <<< "$entry"; else dest="$rest"; fi; else dest="$rest"; fi; [[ "$src" == "$dest" ]] && dest=""; if [[ ! -e "$src" ]]; then echo "Warning: '$src' not found, skipping."; continue; fi; wimlib-imagex update "$wim_file" "$i" --command="add \"$src\" \"$dest/${src##*/}\"" || echo "Error: Failed to inject '$src' into '$wim_file' at index $i."; done; done; }