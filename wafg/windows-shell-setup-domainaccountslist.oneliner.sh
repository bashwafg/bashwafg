windows-shell-setup-domainaccountslist() { local domain="" accounts=(); while [[ $# -gt 0 ]]; do case "$1" in Domain) shift; domain="$1";; adduser) [[ ${#accounts[@]} -gt 0 ]] && accounts+=("adduser"); accounts+=("$1");; *) accounts+=("$1");; esac; shift; done; [[ -z "$domain" ]] && return; echo -e "\t\t\t\t<DomainAccountList wcm:action=\"add\">"; local current_args=(); for arg in "${accounts[@]}" "adduser"; do [[ "$arg" == "adduser" ]] && { [[ ${#current_args[@]} -gt 0 ]] && windows-shell-setup-domainaccount "${current_args[@]}"; current_args=(); } || current_args+=("$arg"); done; echo -e "\t\t\t\t\t<Domain>$domain</Domain>\n\t\t\t\t</DomainAccountList>"; }