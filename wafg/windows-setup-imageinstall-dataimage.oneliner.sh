windows-setup-imageinstall-dataimage() { [[ -z "$DATAIMAGE_ORDER" ]] && DATAIMAGE_ORDER=1; local DiskID="" PartitionID="" Domain="" Password="" Username="" Path="" MetaKey="" MetaValue="" Order="$DATAIMAGE_ORDER"; while [[ $# -gt 0 ]]; do case "$1" in DiskID|PartitionID|Order) eval "$1=\$2"; shift 2 ;; Domain|Password|Username|Path) eval "$1=\$2"; shift 2 ;; MetaData) MetaKey="$2"; MetaValue="$3"; shift 3 ;; *) echo "Unknown parameter: $1" >&2; return 1 ;; esac; done; ((DATAIMAGE_ORDER++)); printf '\t\t\t\t<DataImage wcm:action="add">\n'; [[ -n "$DiskID" || -n "$PartitionID" ]] && { printf '\t\t\t\t\t<InstallTo>\n'; [[ -n "$DiskID" ]] && printf '\t\t\t\t\t\t<DiskID>%s</DiskID>\n' "$DiskID"; [[ -n "$PartitionID" ]] && printf '\t\t\t\t\t\t<PartitionID>%s</PartitionID>\n' "$PartitionID"; printf '\t\t\t\t\t</InstallTo>\n'; }; [[ -n "$Path" ]] && { printf '\t\t\t\t\t<InstallFrom>\n'; [[ -n "$Username" || -n "$Password" || -n "$Domain" ]] && printf '\t\t\t\t\t\t<Credentials>\n'; [[ -n "$Domain" ]] && printf '\t\t\t\t\t\t\t<Domain>%s</Domain>\n' "$Domain"; [[ -n "$Username" ]] && printf '\t\t\t\t\t\t\t<Username>%s</Username>\n' "$Username"; [[ -n "$Password" ]] && printf '\t\t\t\t\t\t\t<Password>%s</Password>\n' "$Password"; [[ -n "$Username" || -n "$Password" || -n "$Domain" ]] && printf '\t\t\t\t\t\t</Credentials>\n'; printf '\t\t\t\t\t\t<Path>%s</Path>\n' "$Path"; [[ -n "$MetaKey" && -n "$MetaValue" ]] && printf '\t\t\t\t\t\t<MetaData wcm:action="add">\n\t\t\t\t\t\t\t<Key>%s</Key>\n\t\t\t\t\t\t\t<Value>%s</Value>\n\t\t\t\t\t\t</MetaData>\n' "$MetaKey" "$MetaValue"; printf '\t\t\t\t\t</InstallFrom>\n'; }; printf '\t\t\t\t\t<Order>%s</Order>\n\t\t\t\t</DataImage>\n' "$Order"; }