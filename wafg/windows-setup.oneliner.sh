#BAD
windows-setup() { local arch="amd64" disk_args=() imageinstall_args=("osimage") userdata_args=() sync_args=() async_args=() remainder_args=(); [[ "$1" == "x86" ]] && { arch="x86"; shift; }; printf '\t\t<component name="Microsoft-Windows-Setup" processorArchitecture="%s" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n' "$arch"; while [[ $# -gt 0 ]]; do case "$1" in disk) shift; while [[ $# -gt 0 && ! "$1" =~ ^(userdata|imageinstall|addrunsynchronous|addrunasynchronous|remainder)$ ]]; do disk_args+=("$1"); shift; done ;; userdata) shift; while [[ $# -gt 0 && ! "$1" =~ ^(disk|imageinstall|addrunsynchronous|addrunasynchronous|remainder)$ ]]; do userdata_args+=("$1"); shift; done ;; imageinstall) shift; imageinstall_args=(); while [[ $# -gt 0 && ! "$1" =~ ^(disk|userdata|addrunsynchronous|addrunasynchronous|remainder)$ ]]; do imageinstall_args+=("$1"); shift; done ;; addrunsynchronous) shift; while [[ $# -gt 0 && ! "$1" =~ ^(disk|userdata|imageinstall|addrunasynchronous|remainder)$ ]]; do sync_args+=("$1"); shift; done ;; addrunasynchronous) shift; while [[ $# -gt 0 && ! "$1" =~ ^(disk|userdata|imageinstall|addrunsynchronous|remainder)$ ]]; do async_args+=("$1"); shift; done ;; remainder) shift; while [[ $# -gt 0 && ! "$1" =~ ^(disk|userdata|imageinstall|addrunsynchronous|addrunasynchronous)$ ]]; do remainder_args+=("$1"); shift; done ;; *) shift ;; esac; done; [[ ${#disk_args[@]} -eq 0 ]] && disk_args=("adddisk" "createpartitions" "$([[ "$arch" == "x86" ]] && echo "BIOS" || echo "EFI")" "modifypartitions" "$([[ "$arch" == "x86" ]] && echo "BIOS" || echo "EFI")"); windows-setup-disk-configuration "${disk_args[@]}"; [[ ${#imageinstall_args[@]} -eq 0 ]] && imageinstall_args=("osimage"); windows-setup-imageinstall "${imageinstall_args[@]}"; windows-setup-userdata "${userdata_args[@]}"; [[ ${#sync_args[@]} -gt 0 ]] && windows-setup-addrunsynchronous "${sync_args[@]}"; [[ ${#async_args[@]} -gt 0 ]] && windows-setup-addrunasynchronous "${async_args[@]}"; [[ ${#remainder_args[@]} -gt 0 ]] && windows-setup-remainder "${remainder_args[@]}"; printf '\t\t</component>\n'; }