windows-setup-disk-configuration-createpartitions() { local args=() order=1 max_order=0; echo -e "\t\t\t\t\t<CreatePartitions>"; while [[ $# -gt 0 ]]; do if [[ "$1" == "add" ]]; then [[ ${#args[@]} -gt 0 ]] && { printf '%s\n' "${args[@]}" | grep -qE '^Order$' || args+=(Order "$order") && ((order++)); windows-setup-disk-configuration-createpartition "${args[@]}"; args=(); }; else [[ "$1" == "Order" ]] && max_order=$(( $2 > max_order ? $2 : max_order )); args+=("$1"); fi; shift; done; [[ ${#args[@]} -gt 0 ]] && { printf '%s\n' "${args[@]}" | grep -qE '^Order$' || args+=(Order "$order"); windows-setup-disk-configuration-createpartition "${args[@]}"; }; echo -e "\t\t\t\t\t</CreatePartitions>"; }