get-iso-file-path() { local input_path="$1" smb_options="${2:+-o $2}"; if [[ "$input_path" == //* ]]; then command -v mount.cifs &>/dev/null || { echo "Error: mount.cifs not found." >&2; return 1; }; local smb_server_share="$(echo "$input_path" | cut -d'/' -f3,4)"; local smb_subpath="$(echo "$input_path" | cut -d'/' -f5-)"; mountpoint -q /tmp/repack-iso && umount /tmp/repack-iso; mkdir -p /tmp/repack-iso; [[ -z "$smb_options" ]] && smb_options="-o username=guest,password="; mount.cifs "//$smb_server_share" /tmp/repack-iso $smb_options 2>/dev/null || mount.cifs "//$smb_server_share" /tmp/repack-iso -o username=user,password=qwerty 2>/dev/null || { echo "Error: Failed to mount SMB share '//$smb_server_share'." >&2; return 1; }; [ -f "/tmp/repack-iso/$smb_subpath" ] && echo "/tmp/repack-iso/$smb_subpath" && return 0 || { echo "Error: File '$smb_subpath' not found in mounted share." >&2; umount /tmp/repack-iso; return 1; }; fi; [ -f "$input_path" ] && echo "$(realpath "$input_path")" && return 0; if [[ "$input_path" == *":"* ]]; then local storage="${input_path%%:*}" filename="${input_path#*:}"; local storage_path="$(awk -v s="$storage" '$1 == "dir:" && $2 == s {f=1; next} f && $1 == "path" {print $2 "/template/iso"; exit} f && /^dir:|lvmthin:/ {exit}' /etc/pve/storage.cfg)"; [ -n "$storage_path" ] && [ -f "$storage_path/$filename" ] && echo "$storage_path/$filename" && return 0; fi; while read -r path; do [ -f "$path/$input_path" ] && echo "$path/$input_path" && return 0; done < <(pvesm status --content iso | awk '$2 == "dir" {print $1}' | while read -r s; do awk -v s="$s" '$1 == "dir:" && $2 == s {f=1; next} f && $1 == "path" {print $2 "/template/iso"; exit} f && /^dir:|lvmthin:/ {exit}' /etc/pve/storage.cfg; done); echo "Error: ISO file '$input_path' not found." >&2; return 1; }